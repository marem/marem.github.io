{"title":"Amazing Altair with an even better theme","markdown":{"yaml":{"title":"Amazing Altair with an even better theme","description":"Implementing best practices for data visualization as an Altair theme.","date":"2024-01-21","image":"images/urban-institute-styleguide.webp","author":"Daniel Kapitan","code-fold":true,"execute":{"freeze":true},"format":{"html":{"toc":true},"ipynb":"default"},"categories":["english","visualization","coding"]},"headingText":"Scatterplot","containsRefs":false,"markdown":"\n\nI have been in love with Altair ever since I first ran into it. The logic, the structure, the syntax: it's all just there and it helps me to get my work done. Paired with [Quarto](https://quarto.org) or [Streamlit](https://streamlit.io), I can create stunning pdf reports, interactive documents and single-page apps for my clients, all from one codebase. After attending a workshop by my fellow data viz afficianado [Sara Sprinkhuizen](https://www.thedatavisionlab.com/), I wanted to implement her tried-and-tested best practices for charts into an Altair.\n\nIn this post, we will illustate how these improvements work for a handful of visualizations that are often used for exploratory data analysis. We will implement her design principles in an Altair theme, such that we can consistently generate better charts in our workflow. Let's start and see how Altair's default theme renders a scatterplot, bar chart and line chart.  \n\n\n\nA scatterplot is one of the most commonly used visualizations. In this case we encode three values for the [Palmer penguins data](https://allisonhorst.github.io/palmerpenguins/): bill length vs. bill depth, per species. The only optimization we apply is to have the axis not go all the way to zero, so the charts is focused on the actual datapoints.\n\n## Bar chart\n\nNext up is the trusty ol' bar chart, which we demonstrate using the wheat dataset. This chart is challenging because it spans two and a half centuries of yearly data, leading to a wide chart with the default settings. Did you turn your head to read the year labels on the x-axis? Or to figure out that the y-axis title reads `wheat`? Surely there must be a better way.\n\n\n\n## Line chart\n\nA line chart with a legend, in this case showing stock prices of a handful of tech companies, is also something we use on a regular basis. Did you even notice the effort you have to put in to lookup the color of the line in the legend? I actually had a hard time distinguishing Amazon and Google, as the red and orange are very alike to  my eyes.\n\n## Some simple but sensible design principles\n\nSara's main points for improving the standard layout of charts basically boil down to the following princples:\n\n- __use informative action titles and subtitles__: much like effective presentations, using so-called [action titles](https://slideworks.io/resources/how-to-write-action-titles-like-mckinsey) will greatly increase the impact of your data visualization. Formulated as a short, simple sentence, action titles should ideally be the main takeaway or ‘so what’ of the chart, and – if done right – allows the audience to only read the title to understand the primary message of the visual.\n- __less is more__: before minimalism became all the rage in design, Edward Tufte coined the principle of [maximizing the data-to-ink ratio](https://infovis-wiki.net/wiki/Data-Ink_Ratio). Charts are easier to read by removing unnecessary clutter. So get rid of gridlines, background colors and the  like.\n- __keep it horizontal__: text is easier to read when it is horizontally aligned. So straighten up those rotated x-axis labels and y-axis titles\n- __lose the legends__: having to lookup colors increases the cognitive load of reading a chart. Use annotations instead.\n\nAll these principles can be readily implemented in Altair. Sergio Sánchez in fact captured the first three principles when implementing the Urban Institute styleguide (shown below) as [an Altair theme](https://towardsdatascience.com/consistently-beautiful-visualizations-with-altair-themes-c7f9f889602).\n\n![](images/urban-institute-styleguide.webp)\n\nBuilding on his work, we created our on theme called __Okabe Ito__, in honour of their work in defining [colorblind-safe color palettes](https://thenode.biologists.com/data-visualization-with-flying-colors/research/). Not only is it functional, but I really like the muted colors, too. Below is a visual from their [original paper](https://jfly.uni-koeln.de/color/) that also shows how different types of colorblindness (protan, deutan, tritan) results in different perception of the colors.\n\n![](images/otabe-ito-pallete.jpg)\n\nTo use this template, download [okabe-ito-theme.py](../resources/okabe-ito-theme.py), put it in the same folder as your notebook and at the following two cells. \n\nTo register the template as an Altair theme:\n\nTo download the fonts used in the template:\n\nLet's see how this changes the charts.\n\n### Adding titles\n\nThe theme automatically has been configured to improve the data-to-ink ratio and align all texts horizontally. Adding action titles can be done using [`alt.TitleParams`](https://altair-viz.github.io/user_guide/customization.html#adjusting-the-title), with which you can not only add a title, but also add multiple subtitles lines which you pass as a list.\n\n### Everything horizontal\n\nThe effect of aligning all text horizontally is a significant improvement on the bar chart, which is now much easier to read. Adding a two-line subtitle make the action title even more compelling. Using `alt.mark_text()` we can easily add footnotes as well, in this case to provide references to the claim.\n\n###  Lose the legends\n\nAlthough legends are fine for exploratory data analysis, where you don't want to spend too much time tweaking your charts, for explanatory data analysis we want to make it as easy on the reader as possible. Unforunately, I couldn't find a way to add annotations (instead of a legend) using Altair's theming engine. Here's a first shot by implementing it manually.\n\nI could go on for hours, tweaking this and that. For example, the labels in the last chart overlap. Vega has the [label transform](https://vega.github.io/vega/docs/transforms/label/) method to deal with that, but that implementation still needs to cascade down to Vega-Lite and Altair. Someday, I will package all this as a proper theme, re-using [feedzai's](https://github.com/feedzai/feedzai-altair-theme) code. \n","srcMarkdownNoYaml":"\n\nI have been in love with Altair ever since I first ran into it. The logic, the structure, the syntax: it's all just there and it helps me to get my work done. Paired with [Quarto](https://quarto.org) or [Streamlit](https://streamlit.io), I can create stunning pdf reports, interactive documents and single-page apps for my clients, all from one codebase. After attending a workshop by my fellow data viz afficianado [Sara Sprinkhuizen](https://www.thedatavisionlab.com/), I wanted to implement her tried-and-tested best practices for charts into an Altair.\n\nIn this post, we will illustate how these improvements work for a handful of visualizations that are often used for exploratory data analysis. We will implement her design principles in an Altair theme, such that we can consistently generate better charts in our workflow. Let's start and see how Altair's default theme renders a scatterplot, bar chart and line chart.  \n\n\n## Scatterplot\n\nA scatterplot is one of the most commonly used visualizations. In this case we encode three values for the [Palmer penguins data](https://allisonhorst.github.io/palmerpenguins/): bill length vs. bill depth, per species. The only optimization we apply is to have the axis not go all the way to zero, so the charts is focused on the actual datapoints.\n\n## Bar chart\n\nNext up is the trusty ol' bar chart, which we demonstrate using the wheat dataset. This chart is challenging because it spans two and a half centuries of yearly data, leading to a wide chart with the default settings. Did you turn your head to read the year labels on the x-axis? Or to figure out that the y-axis title reads `wheat`? Surely there must be a better way.\n\n\n\n## Line chart\n\nA line chart with a legend, in this case showing stock prices of a handful of tech companies, is also something we use on a regular basis. Did you even notice the effort you have to put in to lookup the color of the line in the legend? I actually had a hard time distinguishing Amazon and Google, as the red and orange are very alike to  my eyes.\n\n## Some simple but sensible design principles\n\nSara's main points for improving the standard layout of charts basically boil down to the following princples:\n\n- __use informative action titles and subtitles__: much like effective presentations, using so-called [action titles](https://slideworks.io/resources/how-to-write-action-titles-like-mckinsey) will greatly increase the impact of your data visualization. Formulated as a short, simple sentence, action titles should ideally be the main takeaway or ‘so what’ of the chart, and – if done right – allows the audience to only read the title to understand the primary message of the visual.\n- __less is more__: before minimalism became all the rage in design, Edward Tufte coined the principle of [maximizing the data-to-ink ratio](https://infovis-wiki.net/wiki/Data-Ink_Ratio). Charts are easier to read by removing unnecessary clutter. So get rid of gridlines, background colors and the  like.\n- __keep it horizontal__: text is easier to read when it is horizontally aligned. So straighten up those rotated x-axis labels and y-axis titles\n- __lose the legends__: having to lookup colors increases the cognitive load of reading a chart. Use annotations instead.\n\nAll these principles can be readily implemented in Altair. Sergio Sánchez in fact captured the first three principles when implementing the Urban Institute styleguide (shown below) as [an Altair theme](https://towardsdatascience.com/consistently-beautiful-visualizations-with-altair-themes-c7f9f889602).\n\n![](images/urban-institute-styleguide.webp)\n\nBuilding on his work, we created our on theme called __Okabe Ito__, in honour of their work in defining [colorblind-safe color palettes](https://thenode.biologists.com/data-visualization-with-flying-colors/research/). Not only is it functional, but I really like the muted colors, too. Below is a visual from their [original paper](https://jfly.uni-koeln.de/color/) that also shows how different types of colorblindness (protan, deutan, tritan) results in different perception of the colors.\n\n![](images/otabe-ito-pallete.jpg)\n\nTo use this template, download [okabe-ito-theme.py](../resources/okabe-ito-theme.py), put it in the same folder as your notebook and at the following two cells. \n\nTo register the template as an Altair theme:\n\nTo download the fonts used in the template:\n\nLet's see how this changes the charts.\n\n### Adding titles\n\nThe theme automatically has been configured to improve the data-to-ink ratio and align all texts horizontally. Adding action titles can be done using [`alt.TitleParams`](https://altair-viz.github.io/user_guide/customization.html#adjusting-the-title), with which you can not only add a title, but also add multiple subtitles lines which you pass as a list.\n\n### Everything horizontal\n\nThe effect of aligning all text horizontally is a significant improvement on the bar chart, which is now much easier to read. Adding a two-line subtitle make the action title even more compelling. Using `alt.mark_text()` we can easily add footnotes as well, in this case to provide references to the claim.\n\n###  Lose the legends\n\nAlthough legends are fine for exploratory data analysis, where you don't want to spend too much time tweaking your charts, for explanatory data analysis we want to make it as easy on the reader as possible. Unforunately, I couldn't find a way to add annotations (instead of a legend) using Altair's theming engine. Here's a first shot by implementing it manually.\n\nI could go on for hours, tweaking this and that. For example, the labels in the last chart overlap. Vega has the [label transform](https://vega.github.io/vega/docs/transforms/label/) method to deal with that, but that implementation still needs to cascade down to Vega-Lite and Altair. Someday, I will package all this as a proper theme, re-using [feedzai's](https://github.com/feedzai/feedzai-altair-theme) code. \n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"include-in-header":[{"text":""}],"output-file":"better-altair-theme.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","jupyter":"python3","date-format":"MMM YYYY","theme":{"light":["flatly","../mozilla.scss"]},"title":"Amazing Altair with an even better theme","description":"Implementing best practices for data visualization as an Altair theme.","date":"2024-01-21","image":"images/urban-institute-styleguide.webp","author":"Daniel Kapitan","categories":["english","visualization","coding"]},"extensions":{"book":{"multiFile":true}}},"ipynb":{"identifier":{"display-name":"Jupyter","target-format":"ipynb","base-format":"ipynb"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"png","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"ipynb","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"default-image-extension":"png","to":"ipynb","output-file":"better-altair-theme.ipynb"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"jupyter":"python3","lang":"en","title":"Amazing Altair with an even better theme","description":"Implementing best practices for data visualization as an Altair theme.","date":"2024-01-21","image":"images/urban-institute-styleguide.webp","author":"Daniel Kapitan","categories":["english","visualization","coding"]}}},"projectFormats":["html"]}