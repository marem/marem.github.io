{
  "hash": "48cc32ac6f9f7d0fe1bcfa6f4f9c29f1",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Comet charts in Python\ndescription: Visualizing statistical mix effects and Simpson’s paradox with Altair\ndate: 2021-01-29\nimage: /images/comet-chart.png\nhtml:\n    code-fold: true\ncategories: [english, visualization, coding]\n---\n\n[Zan Armstrong’s comet chart](https://www.zanarmstrong.com/#/infovisresearch/) has been on my list of hobby projects for a while now. I think it is an elegant solution to visualize statistical mix effects and address Simpson’s paradox, and particularly useful when working with longitudinal data involving different sub-populations. Recently I found a good excuse to spend some time to actually use it as part of a exploratory data analysis on a project.\n\nSince I mostly work in Python and have recently fallen in love with [Altair](https://altair-viz.github.io/index.html) — for the same reasons as [Fernando explains here](http://fernandoi.cl/blog/posts/altair/) — I wondered how the comet chart could be implemented using the [grammar of interactive graphics](https://idl.cs.washington.edu/papers/vega-lite/). It took me a while to figure out how to actually plot the comets. In a previous version, I had [drawn glyphs using Bokeh](https://github.com/dkapitan/comet-chart/blob/master/comet-chart.ipynb). While Altair allows you to plot any SVG path in a graph, this felt a bit hacky and not quite in line with the philosophy of using a grammar of graphics.\n\nThankfully [Mattijn was quick to suggest using trail-marks](https://github.com/altair-viz/altair/issues/2395#issuecomment-766454328), after which it was almost as easy as pie. So here’s an example using a dataset of 20,000 flights for 59 destination airports.\n\n::: {#b44a6837 .cell execution_count=1}\n``` {.python .cell-code}\nimport altair as alt\nimport pandas as pd\nimport vega_datasets\n\n\n# Use airline data to assess statistical mix effects of delays\nflights = vega_datasets.data.flights_20k()\naggregation = dict(\n    number_of_flights=(\"destination\", \"count\"),\n    mean_delay=(\"delay\", \"mean\"),\n    mean_distance=(\"distance\", \"mean\"),\n)\n\n# Compare delays by destination between month 1 and 3\ngrouped = flights.groupby(by=[flights.destination, flights.date.dt.month])\ndf = (\n    grouped.agg(**aggregation)\n    .loc[(slice(None), [1, 3]), :]\n    .assign(\n        change_mean_delay=lambda df:\n            df.groupby(\"destination\")[\"mean_delay\"].diff(),\n    )\n    .bfill()  # <--- Changed from .fillna(method=\"bfill\")\n    .reset_index()\n    .round(2)\n)\n\n# Calculate weigthed average of delays for month 1 and 3\ntotal = (\n    flights.groupby(flights.date.dt.month)\n    .agg(**aggregation)\n    .loc[[1, 3], :]\n    .assign(\n        change_mean_delay=lambda df: df.mean_delay.diff(),\n        destination='TOTAL'\n    )\n    .bfill()  # <--- Changed from .fillna(method=\"bfill\")\n    .round(2)\n    .reset_index()\n    .loc[:, df.columns]\n)\n\n\ndef comet_chart(df, stroke=\"white\"):\n    return (\n    alt.Chart(df, width=600, height=450)\n    .mark_trail(stroke=stroke)\n    .encode(\n        x=alt.X(\"number_of_flights\", scale=alt.Scale(type=\"log\")),\n        y=alt.Y(\"mean_delay\"),\n        detail=\"destination\",\n        size=alt.Size(\"date\", scale=alt.Scale(range=[0, 10]), legend=None),\n        tooltip=[\n            \"destination\",\n            \"number_of_flights\",\n            \"mean_delay\",\n            \"change_mean_delay\",\n            \"mean_distance\",\n        ],\n        # trails don't support continuous color\n        # see https://github.com/vega/vega/issues/1187\n        # hence use bins\n        color=alt.Color(\n            \"change_mean_delay:Q\",\n            bin=alt.Bin(step=2),\n            scale=alt.Scale(scheme=\"blueorange\"),\n            legend=alt.Legend(orient=\"top\"),\n        ),\n    )\n)\n\n\ncomet_chart(df) + comet_chart(total, stroke=\"black\")\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n\n<style>\n  #altair-viz-eee5e5263a864bfba695bbb70463f159.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-eee5e5263a864bfba695bbb70463f159.vega-embed details,\n  #altair-viz-eee5e5263a864bfba695bbb70463f159.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-eee5e5263a864bfba695bbb70463f159\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-eee5e5263a864bfba695bbb70463f159\") {\n      outputDiv = document.getElementById(\"altair-viz-eee5e5263a864bfba695bbb70463f159\");\n    }\n\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@6?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@6.1.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@7?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      let deps = [\"vega-embed\"];\n      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"6\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"6.1.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"7\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"layer\": [{\"data\": {\"name\": \"data-577b80a24cc767f3ed67cc46d53cdea1\"}, \"mark\": {\"type\": \"trail\", \"stroke\": \"white\"}, \"encoding\": {\"color\": {\"bin\": {\"step\": 2}, \"field\": \"change_mean_delay\", \"legend\": {\"orient\": \"top\"}, \"scale\": {\"scheme\": \"blueorange\"}, \"type\": \"quantitative\"}, \"detail\": {\"field\": \"destination\", \"type\": \"nominal\"}, \"size\": {\"field\": \"date\", \"legend\": null, \"scale\": {\"range\": [0, 10]}, \"type\": \"quantitative\"}, \"tooltip\": [{\"field\": \"destination\", \"type\": \"nominal\"}, {\"field\": \"number_of_flights\", \"type\": \"quantitative\"}, {\"field\": \"mean_delay\", \"type\": \"quantitative\"}, {\"field\": \"change_mean_delay\", \"type\": \"quantitative\"}, {\"field\": \"mean_distance\", \"type\": \"quantitative\"}], \"x\": {\"field\": \"number_of_flights\", \"scale\": {\"type\": \"log\"}, \"type\": \"quantitative\"}, \"y\": {\"field\": \"mean_delay\", \"type\": \"quantitative\"}}}, {\"data\": {\"name\": \"data-7a6321518d52277115683f06846bda0e\"}, \"mark\": {\"type\": \"trail\", \"stroke\": \"black\"}, \"encoding\": {\"color\": {\"bin\": {\"step\": 2}, \"field\": \"change_mean_delay\", \"legend\": {\"orient\": \"top\"}, \"scale\": {\"scheme\": \"blueorange\"}, \"type\": \"quantitative\"}, \"detail\": {\"field\": \"destination\", \"type\": \"nominal\"}, \"size\": {\"field\": \"date\", \"legend\": null, \"scale\": {\"range\": [0, 10]}, \"type\": \"quantitative\"}, \"tooltip\": [{\"field\": \"destination\", \"type\": \"nominal\"}, {\"field\": \"number_of_flights\", \"type\": \"quantitative\"}, {\"field\": \"mean_delay\", \"type\": \"quantitative\"}, {\"field\": \"change_mean_delay\", \"type\": \"quantitative\"}, {\"field\": \"mean_distance\", \"type\": \"quantitative\"}], \"x\": {\"field\": \"number_of_flights\", \"scale\": {\"type\": \"log\"}, \"type\": \"quantitative\"}, \"y\": {\"field\": \"mean_delay\", \"type\": \"quantitative\"}}}], \"height\": 450, \"width\": 600, \"$schema\": \"https://vega.github.io/schema/vega-lite/v6.1.0.json\", \"datasets\": {\"data-577b80a24cc767f3ed67cc46d53cdea1\": [{\"destination\": \"ABQ\", \"date\": 1, \"number_of_flights\": 129, \"mean_delay\": 7.98, \"mean_distance\": 552.15, \"change_mean_delay\": -0.45}, {\"destination\": \"ABQ\", \"date\": 3, \"number_of_flights\": 164, \"mean_delay\": 7.53, \"mean_distance\": 568.41, \"change_mean_delay\": -0.45}, {\"destination\": \"ALB\", \"date\": 1, \"number_of_flights\": 36, \"mean_delay\": 7.03, \"mean_distance\": 570.72, \"change_mean_delay\": 4.2}, {\"destination\": \"ALB\", \"date\": 3, \"number_of_flights\": 22, \"mean_delay\": 11.23, \"mean_distance\": 536.55, \"change_mean_delay\": 4.2}, {\"destination\": \"AMA\", \"date\": 1, \"number_of_flights\": 18, \"mean_delay\": 12.0, \"mean_distance\": 313.56, \"change_mean_delay\": -1.41}, {\"destination\": \"AMA\", \"date\": 3, \"number_of_flights\": 22, \"mean_delay\": 10.59, \"mean_distance\": 383.18, \"change_mean_delay\": -1.41}, {\"destination\": \"AUS\", \"date\": 1, \"number_of_flights\": 124, \"mean_delay\": 5.31, \"mean_distance\": 450.31, \"change_mean_delay\": 4.71}, {\"destination\": \"AUS\", \"date\": 3, \"number_of_flights\": 124, \"mean_delay\": 10.02, \"mean_distance\": 467.61, \"change_mean_delay\": 4.71}, {\"destination\": \"BDL\", \"date\": 1, \"number_of_flights\": 32, \"mean_delay\": 17.62, \"mean_distance\": 509.41, \"change_mean_delay\": -4.91}, {\"destination\": \"BDL\", \"date\": 3, \"number_of_flights\": 49, \"mean_delay\": 12.71, \"mean_distance\": 555.51, \"change_mean_delay\": -4.91}, {\"destination\": \"BHM\", \"date\": 1, \"number_of_flights\": 77, \"mean_delay\": 6.47, \"mean_distance\": 516.97, \"change_mean_delay\": -0.04}, {\"destination\": \"BHM\", \"date\": 3, \"number_of_flights\": 77, \"mean_delay\": 6.43, \"mean_distance\": 504.38, \"change_mean_delay\": -0.04}, {\"destination\": \"BNA\", \"date\": 1, \"number_of_flights\": 216, \"mean_delay\": 8.24, \"mean_distance\": 776.31, \"change_mean_delay\": -1.75}, {\"destination\": \"BNA\", \"date\": 3, \"number_of_flights\": 227, \"mean_delay\": 6.48, \"mean_distance\": 714.56, \"change_mean_delay\": -1.75}, {\"destination\": \"BOI\", \"date\": 1, \"number_of_flights\": 44, \"mean_delay\": 11.11, \"mean_distance\": 352.68, \"change_mean_delay\": -10.29}, {\"destination\": \"BOI\", \"date\": 3, \"number_of_flights\": 35, \"mean_delay\": 0.83, \"mean_distance\": 349.97, \"change_mean_delay\": -10.29}, {\"destination\": \"BUF\", \"date\": 1, \"number_of_flights\": 19, \"mean_delay\": -3.53, \"mean_distance\": 734.58, \"change_mean_delay\": -4.3}, {\"destination\": \"BUF\", \"date\": 3, \"number_of_flights\": 28, \"mean_delay\": -7.82, \"mean_distance\": 809.11, \"change_mean_delay\": -4.3}, {\"destination\": \"BUR\", \"date\": 1, \"number_of_flights\": 121, \"mean_delay\": 10.31, \"mean_distance\": 302.52, \"change_mean_delay\": -1.1}, {\"destination\": \"BUR\", \"date\": 3, \"number_of_flights\": 127, \"mean_delay\": 9.21, \"mean_distance\": 307.75, \"change_mean_delay\": -1.1}, {\"destination\": \"BWI\", \"date\": 1, \"number_of_flights\": 301, \"mean_delay\": 5.23, \"mean_distance\": 602.16, \"change_mean_delay\": -0.03}, {\"destination\": \"BWI\", \"date\": 3, \"number_of_flights\": 302, \"mean_delay\": 5.2, \"mean_distance\": 624.67, \"change_mean_delay\": -0.03}, {\"destination\": \"CLE\", \"date\": 1, \"number_of_flights\": 53, \"mean_delay\": 14.4, \"mean_distance\": 369.08, \"change_mean_delay\": -8.11}, {\"destination\": \"CLE\", \"date\": 3, \"number_of_flights\": 60, \"mean_delay\": 6.28, \"mean_distance\": 360.93, \"change_mean_delay\": -8.11}, {\"destination\": \"CMH\", \"date\": 1, \"number_of_flights\": 32, \"mean_delay\": 8.88, \"mean_distance\": 505.91, \"change_mean_delay\": -3.51}, {\"destination\": \"CMH\", \"date\": 3, \"number_of_flights\": 30, \"mean_delay\": 5.37, \"mean_distance\": 481.0, \"change_mean_delay\": -3.51}, {\"destination\": \"CRP\", \"date\": 1, \"number_of_flights\": 20, \"mean_delay\": 10.85, \"mean_distance\": 187.0, \"change_mean_delay\": 3.77}, {\"destination\": \"CRP\", \"date\": 3, \"number_of_flights\": 21, \"mean_delay\": 14.62, \"mean_distance\": 187.0, \"change_mean_delay\": 3.77}, {\"destination\": \"DAL\", \"date\": 1, \"number_of_flights\": 304, \"mean_delay\": 3.37, \"mean_distance\": 299.76, \"change_mean_delay\": 3.46}, {\"destination\": \"DAL\", \"date\": 3, \"number_of_flights\": 372, \"mean_delay\": 6.83, \"mean_distance\": 293.83, \"change_mean_delay\": 3.46}, {\"destination\": \"DTW\", \"date\": 1, \"number_of_flights\": 45, \"mean_delay\": 8.02, \"mean_distance\": 334.04, \"change_mean_delay\": 0.79}, {\"destination\": \"DTW\", \"date\": 3, \"number_of_flights\": 37, \"mean_delay\": 8.81, \"mean_distance\": 347.19, \"change_mean_delay\": 0.79}, {\"destination\": \"ELP\", \"date\": 1, \"number_of_flights\": 106, \"mean_delay\": 10.84, \"mean_distance\": 494.27, \"change_mean_delay\": -6.49}, {\"destination\": \"ELP\", \"date\": 3, \"number_of_flights\": 94, \"mean_delay\": 4.35, \"mean_distance\": 490.43, \"change_mean_delay\": -6.49}, {\"destination\": \"FLL\", \"date\": 1, \"number_of_flights\": 83, \"mean_delay\": 5.78, \"mean_distance\": 435.34, \"change_mean_delay\": 4.5}, {\"destination\": \"FLL\", \"date\": 3, \"number_of_flights\": 60, \"mean_delay\": 10.28, \"mean_distance\": 405.17, \"change_mean_delay\": 4.5}, {\"destination\": \"GEG\", \"date\": 1, \"number_of_flights\": 42, \"mean_delay\": 13.29, \"mean_distance\": 303.36, \"change_mean_delay\": -6.47}, {\"destination\": \"GEG\", \"date\": 3, \"number_of_flights\": 43, \"mean_delay\": 6.81, \"mean_distance\": 277.93, \"change_mean_delay\": -6.47}, {\"destination\": \"HOU\", \"date\": 1, \"number_of_flights\": 336, \"mean_delay\": 6.22, \"mean_distance\": 422.08, \"change_mean_delay\": 1.77}, {\"destination\": \"HOU\", \"date\": 3, \"number_of_flights\": 344, \"mean_delay\": 7.99, \"mean_distance\": 437.76, \"change_mean_delay\": 1.77}, {\"destination\": \"HRL\", \"date\": 1, \"number_of_flights\": 35, \"mean_delay\": 14.2, \"mean_distance\": 268.37, \"change_mean_delay\": -2.56}, {\"destination\": \"HRL\", \"date\": 3, \"number_of_flights\": 42, \"mean_delay\": 11.64, \"mean_distance\": 270.98, \"change_mean_delay\": -2.56}, {\"destination\": \"IAH\", \"date\": 1, \"number_of_flights\": 17, \"mean_delay\": 4.71, \"mean_distance\": 217.0, \"change_mean_delay\": -8.59}, {\"destination\": \"IAH\", \"date\": 3, \"number_of_flights\": 9, \"mean_delay\": -3.89, \"mean_distance\": 217.0, \"change_mean_delay\": -8.59}, {\"destination\": \"IND\", \"date\": 1, \"number_of_flights\": 58, \"mean_delay\": 4.69, \"mean_distance\": 574.14, \"change_mean_delay\": -0.05}, {\"destination\": \"IND\", \"date\": 3, \"number_of_flights\": 58, \"mean_delay\": 4.64, \"mean_distance\": 702.16, \"change_mean_delay\": -0.05}, {\"destination\": \"ISP\", \"date\": 1, \"number_of_flights\": 55, \"mean_delay\": 3.11, \"mean_distance\": 472.58, \"change_mean_delay\": 5.34}, {\"destination\": \"ISP\", \"date\": 3, \"number_of_flights\": 58, \"mean_delay\": 8.45, \"mean_distance\": 528.83, \"change_mean_delay\": 5.34}, {\"destination\": \"JAN\", \"date\": 1, \"number_of_flights\": 23, \"mean_delay\": 3.96, \"mean_distance\": 613.04, \"change_mean_delay\": -3.44}, {\"destination\": \"JAN\", \"date\": 3, \"number_of_flights\": 25, \"mean_delay\": 0.52, \"mean_distance\": 562.68, \"change_mean_delay\": -3.44}, {\"destination\": \"JAX\", \"date\": 1, \"number_of_flights\": 65, \"mean_delay\": 7.12, \"mean_distance\": 407.82, \"change_mean_delay\": 8.83}, {\"destination\": \"JAX\", \"date\": 3, \"number_of_flights\": 66, \"mean_delay\": 15.95, \"mean_distance\": 424.85, \"change_mean_delay\": 8.83}, {\"destination\": \"LAS\", \"date\": 1, \"number_of_flights\": 428, \"mean_delay\": 14.16, \"mean_distance\": 553.36, \"change_mean_delay\": -6.12}, {\"destination\": \"LAS\", \"date\": 3, \"number_of_flights\": 405, \"mean_delay\": 8.04, \"mean_distance\": 567.54, \"change_mean_delay\": -6.12}, {\"destination\": \"LAX\", \"date\": 1, \"number_of_flights\": 300, \"mean_delay\": 8.46, \"mean_distance\": 529.91, \"change_mean_delay\": -0.22}, {\"destination\": \"LAX\", \"date\": 3, \"number_of_flights\": 325, \"mean_delay\": 8.24, \"mean_distance\": 489.88, \"change_mean_delay\": -0.22}, {\"destination\": \"LBB\", \"date\": 1, \"number_of_flights\": 36, \"mean_delay\": 3.39, \"mean_distance\": 351.61, \"change_mean_delay\": 2.55}, {\"destination\": \"LBB\", \"date\": 3, \"number_of_flights\": 49, \"mean_delay\": 5.94, \"mean_distance\": 338.22, \"change_mean_delay\": 2.55}, {\"destination\": \"LIT\", \"date\": 1, \"number_of_flights\": 30, \"mean_delay\": 2.07, \"mean_distance\": 375.0, \"change_mean_delay\": -0.95}, {\"destination\": \"LIT\", \"date\": 3, \"number_of_flights\": 51, \"mean_delay\": 1.12, \"mean_distance\": 408.65, \"change_mean_delay\": -0.95}, {\"destination\": \"MAF\", \"date\": 1, \"number_of_flights\": 37, \"mean_delay\": 8.89, \"mean_distance\": 369.3, \"change_mean_delay\": -3.7}, {\"destination\": \"MAF\", \"date\": 3, \"number_of_flights\": 31, \"mean_delay\": 5.19, \"mean_distance\": 398.26, \"change_mean_delay\": -3.7}, {\"destination\": \"MCI\", \"date\": 1, \"number_of_flights\": 176, \"mean_delay\": 6.41, \"mean_distance\": 707.56, \"change_mean_delay\": -1.04}, {\"destination\": \"MCI\", \"date\": 3, \"number_of_flights\": 207, \"mean_delay\": 5.37, \"mean_distance\": 745.93, \"change_mean_delay\": -1.04}, {\"destination\": \"MCO\", \"date\": 1, \"number_of_flights\": 132, \"mean_delay\": 2.74, \"mean_distance\": 728.77, \"change_mean_delay\": 5.57}, {\"destination\": \"MCO\", \"date\": 3, \"number_of_flights\": 130, \"mean_delay\": 8.31, \"mean_distance\": 743.67, \"change_mean_delay\": 5.57}, {\"destination\": \"MDW\", \"date\": 1, \"number_of_flights\": 312, \"mean_delay\": 5.24, \"mean_distance\": 461.4, \"change_mean_delay\": 0.61}, {\"destination\": \"MDW\", \"date\": 3, \"number_of_flights\": 302, \"mean_delay\": 5.85, \"mean_distance\": 440.93, \"change_mean_delay\": 0.61}, {\"destination\": \"MHT\", \"date\": 1, \"number_of_flights\": 43, \"mean_delay\": 5.12, \"mean_distance\": 692.26, \"change_mean_delay\": 1.93}, {\"destination\": \"MHT\", \"date\": 3, \"number_of_flights\": 48, \"mean_delay\": 7.04, \"mean_distance\": 747.04, \"change_mean_delay\": 1.93}, {\"destination\": \"MSY\", \"date\": 1, \"number_of_flights\": 171, \"mean_delay\": 4.77, \"mean_distance\": 487.86, \"change_mean_delay\": 0.41}, {\"destination\": \"MSY\", \"date\": 3, \"number_of_flights\": 151, \"mean_delay\": 5.17, \"mean_distance\": 517.47, \"change_mean_delay\": 0.41}, {\"destination\": \"OAK\", \"date\": 1, \"number_of_flights\": 278, \"mean_delay\": 7.93, \"mean_distance\": 430.95, \"change_mean_delay\": -4.1}, {\"destination\": \"OAK\", \"date\": 3, \"number_of_flights\": 324, \"mean_delay\": 3.83, \"mean_distance\": 444.32, \"change_mean_delay\": -4.1}, {\"destination\": \"OKC\", \"date\": 1, \"number_of_flights\": 54, \"mean_delay\": 7.24, \"mean_distance\": 369.04, \"change_mean_delay\": -6.21}, {\"destination\": \"OKC\", \"date\": 3, \"number_of_flights\": 69, \"mean_delay\": 1.03, \"mean_distance\": 393.9, \"change_mean_delay\": -6.21}, {\"destination\": \"OMA\", \"date\": 1, \"number_of_flights\": 49, \"mean_delay\": 3.29, \"mean_distance\": 625.84, \"change_mean_delay\": 1.98}, {\"destination\": \"OMA\", \"date\": 3, \"number_of_flights\": 42, \"mean_delay\": 5.26, \"mean_distance\": 690.24, \"change_mean_delay\": 1.98}, {\"destination\": \"ONT\", \"date\": 1, \"number_of_flights\": 165, \"mean_delay\": 13.24, \"mean_distance\": 349.81, \"change_mean_delay\": -9.24}, {\"destination\": \"ONT\", \"date\": 3, \"number_of_flights\": 145, \"mean_delay\": 4.0, \"mean_distance\": 331.07, \"change_mean_delay\": -9.24}, {\"destination\": \"PBI\", \"date\": 1, \"number_of_flights\": 13, \"mean_delay\": 6.77, \"mean_distance\": 325.54, \"change_mean_delay\": -2.56}, {\"destination\": \"PBI\", \"date\": 3, \"number_of_flights\": 34, \"mean_delay\": 4.21, \"mean_distance\": 329.26, \"change_mean_delay\": -2.56}, {\"destination\": \"PDX\", \"date\": 1, \"number_of_flights\": 89, \"mean_delay\": 9.4, \"mean_distance\": 532.08, \"change_mean_delay\": -2.3}, {\"destination\": \"PDX\", \"date\": 3, \"number_of_flights\": 70, \"mean_delay\": 7.1, \"mean_distance\": 567.11, \"change_mean_delay\": -2.3}, {\"destination\": \"PHX\", \"date\": 1, \"number_of_flights\": 411, \"mean_delay\": 12.57, \"mean_distance\": 675.43, \"change_mean_delay\": -2.88}, {\"destination\": \"PHX\", \"date\": 3, \"number_of_flights\": 486, \"mean_delay\": 9.69, \"mean_distance\": 637.73, \"change_mean_delay\": -2.88}, {\"destination\": \"PVD\", \"date\": 1, \"number_of_flights\": 57, \"mean_delay\": 3.19, \"mean_distance\": 650.26, \"change_mean_delay\": -3.33}, {\"destination\": \"PVD\", \"date\": 3, \"number_of_flights\": 59, \"mean_delay\": -0.14, \"mean_distance\": 709.05, \"change_mean_delay\": -3.33}, {\"destination\": \"RDU\", \"date\": 1, \"number_of_flights\": 41, \"mean_delay\": 3.49, \"mean_distance\": 437.05, \"change_mean_delay\": 0.33}, {\"destination\": \"RDU\", \"date\": 3, \"number_of_flights\": 44, \"mean_delay\": 3.82, \"mean_distance\": 484.86, \"change_mean_delay\": 0.33}, {\"destination\": \"RNO\", \"date\": 1, \"number_of_flights\": 123, \"mean_delay\": 8.98, \"mean_distance\": 362.15, \"change_mean_delay\": -2.9}, {\"destination\": \"RNO\", \"date\": 3, \"number_of_flights\": 92, \"mean_delay\": 6.08, \"mean_distance\": 382.78, \"change_mean_delay\": -2.9}, {\"destination\": \"SAN\", \"date\": 1, \"number_of_flights\": 212, \"mean_delay\": 12.45, \"mean_distance\": 488.73, \"change_mean_delay\": -8.2}, {\"destination\": \"SAN\", \"date\": 3, \"number_of_flights\": 174, \"mean_delay\": 4.25, \"mean_distance\": 455.28, \"change_mean_delay\": -8.2}, {\"destination\": \"SAT\", \"date\": 1, \"number_of_flights\": 120, \"mean_delay\": 7.34, \"mean_distance\": 446.72, \"change_mean_delay\": 0.3}, {\"destination\": \"SAT\", \"date\": 3, \"number_of_flights\": 110, \"mean_delay\": 7.65, \"mean_distance\": 473.84, \"change_mean_delay\": 0.3}, {\"destination\": \"SDF\", \"date\": 1, \"number_of_flights\": 68, \"mean_delay\": 7.57, \"mean_distance\": 491.19, \"change_mean_delay\": -5.8}, {\"destination\": \"SDF\", \"date\": 3, \"number_of_flights\": 49, \"mean_delay\": 1.78, \"mean_distance\": 467.67, \"change_mean_delay\": -5.8}, {\"destination\": \"SEA\", \"date\": 1, \"number_of_flights\": 96, \"mean_delay\": 10.68, \"mean_distance\": 638.96, \"change_mean_delay\": 3.6}, {\"destination\": \"SEA\", \"date\": 3, \"number_of_flights\": 94, \"mean_delay\": 14.28, \"mean_distance\": 652.84, \"change_mean_delay\": 3.6}, {\"destination\": \"SFO\", \"date\": 1, \"number_of_flights\": 33, \"mean_delay\": 14.52, \"mean_distance\": 558.27, \"change_mean_delay\": 5.23}, {\"destination\": \"SFO\", \"date\": 3, \"number_of_flights\": 4, \"mean_delay\": 19.75, \"mean_distance\": 498.0, \"change_mean_delay\": 5.23}, {\"destination\": \"SJC\", \"date\": 1, \"number_of_flights\": 197, \"mean_delay\": 10.92, \"mean_distance\": 384.56, \"change_mean_delay\": -6.35}, {\"destination\": \"SJC\", \"date\": 3, \"number_of_flights\": 191, \"mean_delay\": 4.57, \"mean_distance\": 404.65, \"change_mean_delay\": -6.35}, {\"destination\": \"SLC\", \"date\": 1, \"number_of_flights\": 102, \"mean_delay\": 10.95, \"mean_distance\": 605.62, \"change_mean_delay\": -0.82}, {\"destination\": \"SLC\", \"date\": 3, \"number_of_flights\": 110, \"mean_delay\": 10.13, \"mean_distance\": 520.6, \"change_mean_delay\": -0.82}, {\"destination\": \"SMF\", \"date\": 1, \"number_of_flights\": 162, \"mean_delay\": 9.86, \"mean_distance\": 469.78, \"change_mean_delay\": -7.17}, {\"destination\": \"SMF\", \"date\": 3, \"number_of_flights\": 188, \"mean_delay\": 2.69, \"mean_distance\": 446.46, \"change_mean_delay\": -7.17}, {\"destination\": \"SNA\", \"date\": 1, \"number_of_flights\": 31, \"mean_delay\": 10.0, \"mean_distance\": 351.35, \"change_mean_delay\": -4.75}, {\"destination\": \"SNA\", \"date\": 3, \"number_of_flights\": 32, \"mean_delay\": 5.25, \"mean_distance\": 355.59, \"change_mean_delay\": -4.75}, {\"destination\": \"STL\", \"date\": 1, \"number_of_flights\": 199, \"mean_delay\": 5.77, \"mean_distance\": 478.18, \"change_mean_delay\": -1.5}, {\"destination\": \"STL\", \"date\": 3, \"number_of_flights\": 202, \"mean_delay\": 4.27, \"mean_distance\": 516.59, \"change_mean_delay\": -1.5}, {\"destination\": \"TPA\", \"date\": 1, \"number_of_flights\": 114, \"mean_delay\": 3.75, \"mean_distance\": 577.17, \"change_mean_delay\": 11.05}, {\"destination\": \"TPA\", \"date\": 3, \"number_of_flights\": 150, \"mean_delay\": 14.79, \"mean_distance\": 631.63, \"change_mean_delay\": 11.05}, {\"destination\": \"TUL\", \"date\": 1, \"number_of_flights\": 70, \"mean_delay\": 10.69, \"mean_distance\": 391.53, \"change_mean_delay\": -3.22}, {\"destination\": \"TUL\", \"date\": 3, \"number_of_flights\": 65, \"mean_delay\": 7.46, \"mean_distance\": 384.25, \"change_mean_delay\": -3.22}, {\"destination\": \"TUS\", \"date\": 1, \"number_of_flights\": 44, \"mean_delay\": 9.18, \"mean_distance\": 390.95, \"change_mean_delay\": -3.15}, {\"destination\": \"TUS\", \"date\": 3, \"number_of_flights\": 31, \"mean_delay\": 6.03, \"mean_distance\": 404.42, \"change_mean_delay\": -3.15}], \"data-7a6321518d52277115683f06846bda0e\": [{\"destination\": \"TOTAL\", \"date\": 1, \"number_of_flights\": 6784, \"mean_delay\": 8.24, \"mean_distance\": 500.39, \"change_mean_delay\": -1.44}, {\"destination\": \"TOTAL\", \"date\": 3, \"number_of_flights\": 6960, \"mean_delay\": 6.8, \"mean_distance\": 504.71, \"change_mean_delay\": -1.44}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\nIn the example shown here, each comet represents one destination airport. The head of the comet corresponds to the most recent observation of the number of flight arrivals (x-axis, shown as logarithmic scale to accommodate the wide range of observations) against the mean delay of those flights (y-axis). The tail of the comet represents a similar (x,y) datum, but from an earlier point in time. Finally, the colour of the comet is encoded to show the change in the mean delay for each airport. A tooltip with a summary of the data is shown when hovering over the head of the comet.\n\nSo-called mix effects can often lead to misinterpretation of aggregate numbers. In the example of flight delays, the fact that only a small change is observed in the mean delay across all airports — visualized with the right-most comet outlined in black — hides the underlying variance between airports. Note that in this example the size of each sub-population (number of flights per airport) remains relatively constant, hence the comets here only go up and down. As explained in [the original article](https://storage.googleapis.com/pub-tools-public-publication-data/pdf/42901.pdf), mix effects become harder to interpret when the relative size of the sub-populations change as well as their relative values. In the most extreme case this may lead to [Simpson’s paradox](https://en.wikipedia.org/wiki/Simpson%27s_paradox).\n\nWith this base implementation of comet charts in Altair, you can really go to town and combine it with other interactive graphs. Using the [overview-detail](https://altair-viz.github.io/gallery/scatter_with_layered_histogram.html) pattern, you could plot an accompanying density plot of all the flights for a given airport. That way you can quickly zoom in to the lowest level of detail and get a better understanding of the underlying mix effects.\n\n",
    "supporting": [
      "comet-chart_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}